using CSV
using DataFrames
using Dates
using PlotlyJS

dir_repo="/code/Monte_Carlo/"
dir_output="/data/Monte_Carlo/SIM/rand1/"

estaciones=DataFrame(CSV.File(dir_repo*"ST.csv"))
SerieHistórica=DataFrame(CSV.File(dir_repo*"hist/PRECIPITACIONES_MENSUALES.csv"))
SerieHistórica[!,"Mes"]=añohidr.(SerieHistórica[!,"Mes"])

for i in 1:24
estación=string(estaciones[i,"ST"])
directorio_salida=dir_output*"boxplot/"
precipitacionesMC=DataFrame(CSV.File(directorio_salida*estación*"pr.csv"))
graficarST(directorio_salida,estación,SerieHistórica,precipitacionesMC)
end

#Realiza resumen de los archivos CSV.
for i in 2:24
   unirRCPCSV(string(estaciones[i,"ST"]),1000)
end

function graficarST(directorio_salida,estacion,precipitaciones,precipitacionesMC)

ST=Symbol(estacion)
RCP45=Symbol("RCP4.5down")
RCP60=Symbol("RCP6.0down")
RCP85=Symbol("RCP8.5down")

SerieH=box(
    precipitaciones,
    x=:Mes,y=ST,
    name="Historical time series",
    marker_color="rgb(9,56,125)"
    )

Serie45=box(
    precipitacionesMC,
    x=:Mes,y=RCP45,
    name="ANN RCP4.5",
    marker_color="rgb(255,255,0)"
    )

Serie60=box(
    precipitacionesMC,
    x=:Mes,y=RCP60,
    name="ANN RCP6.0",
    marker_color="rgb(255,196,0)"
    )

Serie85=box(
    precipitacionesMC,
    x=:Mes,y=RCP85,
    name="ANN RCP8.5",
    marker_color="rgb(255,0,0)"
    )

diagrama=plot([SerieH, Serie45, Serie60, Serie85],
              Layout(boxmode="group",
                     xaxis=attr(title="Year",
                                zeroline=true,
                                showline=true,
                                zerolinecolor="#000000",
                                linecolor="#000000",
                     ),
                     yaxis=attr(title="Rainfall (mm)",
                                showgrid=true,
                                zeroline=true,
                                showline=true,
                                gridcolor="#000000",
                                zerolinecolor="#000000",
                                linecolor="#000000",                                
                                ),
                     yaxis_range=[0, 400],
                     font=attr(
                        family="Times New Roman",
                        size=30,
                        color="#000000"),
                     plot_bgcolor="#FFFFFF"                     
                     )
              )
#savefig(diagrama,directorio_salida*estacion*".html")
#savefig(diagrama,directorio_salida*estacion*".png",width=7*300,height=2*300)
savefig(diagrama,directorio_salida*estacion*".pdf",width=7*300,height=2*300)

end

function añohidr(fecha)
    mes=Dates.month(fecha)
    año=Dates.year(fecha)
    if mes>=10
        return año
    else
        return año-1
    end
end
